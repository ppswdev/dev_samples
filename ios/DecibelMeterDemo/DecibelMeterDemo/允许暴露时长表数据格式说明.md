# å…è®¸æš´éœ²æ—¶é•¿è¡¨ - æ•°æ®æ ¼å¼è¯´æ˜

## ğŸ“Š æœ€ç»ˆæ•°æ®æ ¼å¼

### è¡¨æ ¼ç»“æ„

```
å£°çº§		å…è®¸æ—¶é•¿		ç´¯è®¡è¾¾æ ‡æ—¶é•¿(ç§’)	å½“å‰å£°çº§å‰‚é‡
------------------------------------------------------------
85dB		8h			300				6.3%
88dB		4h			450				18.8%
91dB		2h			200				16.7%
94dB		1h			120				20.0%
97dB		30min		60				20.0%
100dB		15min		30				20.0%
103dB		8min		0				0.0%
106dB		4min		0				0.0%
109dB		2min		0				0.0%
112dB		1min		0				0.0%
115dB		28s			0				0.0%
------------------------------------------------------------
æ€»å‰‚é‡: 101.8%
```

### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | å•ä½ | è¯´æ˜ |
|-------|------|------|------|
| å£°çº§ | Double | dB | å™ªå£°å£°çº§å€¼ï¼ˆå¦‚ï¼š85dB, 88dBï¼‰ |
| å…è®¸æ—¶é•¿ | String | h/min/s | è¯¥å£°çº§ä¸‹çš„æœ€å¤§å…è®¸æš´éœ²æ—¶é—´ |
| ç´¯è®¡è¾¾æ ‡æ—¶é•¿ | Int | ç§’ | å®é™…æµ‹é‡ä¸­åœ¨è¯¥å£°çº§èŒƒå›´å†…çš„ç´¯è®¡æ—¶é—´ |
| å½“å‰å£°çº§å‰‚é‡ | Double | % | è¯¥å£°çº§çš„å‰‚é‡è´¡çŒ®ç™¾åˆ†æ¯” |

---

## ğŸ”¢ æ•°æ®æ¥æº

### 1. å£°çº§åˆ—è¡¨ç”Ÿæˆ

æ ¹æ®æ ‡å‡†çš„**åŸºå‡†é™å€¼**å’Œ**äº¤æ¢ç‡**ç”Ÿæˆï¼š

**NIOSHæ ‡å‡†ç¤ºä¾‹**ï¼š
- åŸºå‡†é™å€¼ï¼š85 dB
- äº¤æ¢ç‡ï¼š3 dB
- å¤©èŠ±æ¿é™å€¼ï¼š115 dB
- ç”Ÿæˆåˆ—è¡¨ï¼š85, 88, 91, 94, 97, 100, 103, 106, 109, 112, 115 dBï¼ˆå…±11æ¡ï¼‰

**OSHAæ ‡å‡†ç¤ºä¾‹**ï¼š
- åŸºå‡†é™å€¼ï¼š90 dB
- äº¤æ¢ç‡ï¼š5 dB
- å¤©èŠ±æ¿é™å€¼ï¼š115 dB
- ç”Ÿæˆåˆ—è¡¨ï¼š90, 95, 100, 105, 110, 115 dBï¼ˆå…±6æ¡ï¼‰

### 2. å…è®¸æ—¶é•¿è®¡ç®—

å…¬å¼ï¼š
```
å…è®¸æ—¶é•¿ = 8å°æ—¶ Ã— 2^((åŸºå‡†é™å€¼ - å£°çº§) / äº¤æ¢ç‡)
```

**NIOSHæ ‡å‡†è®¡ç®—ç¤ºä¾‹**ï¼š
```
85dB: 8 Ã— 2^((85-85)/3) = 8 Ã— 2^0 = 8å°æ—¶
88dB: 8 Ã— 2^((85-88)/3) = 8 Ã— 2^-1 = 4å°æ—¶
91dB: 8 Ã— 2^((85-91)/3) = 8 Ã— 2^-2 = 2å°æ—¶
94dB: 8 Ã— 2^((85-94)/3) = 8 Ã— 2^-3 = 1å°æ—¶
97dB: 8 Ã— 2^((85-97)/3) = 8 Ã— 2^-4 = 0.5å°æ—¶ = 30åˆ†é’Ÿ
```

### 3. ç´¯è®¡è¾¾æ ‡æ—¶é•¿ç»Ÿè®¡

- éå†æ‰€æœ‰æµ‹é‡å†å²æ•°æ®
- æ ¹æ®å£°çº§å€¼åˆ†é…åˆ°å¯¹åº”çš„å£°çº§åŒºé—´
- æ¯ä¸ªæµ‹é‡ç‚¹ä»£è¡¨çº¦1ç§’çš„æš´éœ²æ—¶é—´
- ç´¯åŠ æ¯ä¸ªåŒºé—´çš„æš´éœ²æ—¶é—´

**å£°çº§åŒºé—´åˆ’åˆ†**ï¼š
- 85dBåŒºé—´ï¼š[85, 88) dB
- 88dBåŒºé—´ï¼š[88, 91) dB
- 91dBåŒºé—´ï¼š[91, 94) dB
- ...

### 4. å½“å‰å£°çº§å‰‚é‡è®¡ç®—

å…¬å¼ï¼š
```
å½“å‰å£°çº§å‰‚é‡ = (ç´¯è®¡è¾¾æ ‡æ—¶é•¿ / å…è®¸æ—¶é•¿) Ã— 100%
```

**è®¡ç®—ç¤ºä¾‹**ï¼š
```
85dB: (300ç§’ / 28800ç§’) Ã— 100% = 1.04%
88dB: (450ç§’ / 14400ç§’) Ã— 100% = 3.13%
91dB: (200ç§’ / 7200ç§’) Ã— 100% = 2.78%
```

### 5. æ€»å‰‚é‡è®¡ç®—

```
æ€»å‰‚é‡ = Î£ å„å£°çº§å‰‚é‡
æ€»å‰‚é‡ = 1.04% + 3.13% + 2.78% + ... = 101.8%
```

---

## ğŸ’» ä»£ç è·å–ç¤ºä¾‹

### Swiftä»£ç 

```swift
let manager = DecibelMeterManager.shared
let table = manager.getPermissibleExposureDurationTable(standard: .niosh)

// éå†æ‰€æœ‰è¡Œ
for duration in table.durations {
    let soundLevel = String(format: "%.0fdB", duration.soundLevel)
    let allowedTime = formatTimeToHours(duration.allowedDuration)
    let accumulated = Int(duration.accumulatedDuration)
    let dose = String(format: "%.1f%%", duration.currentLevelDose)
    
    print("\(soundLevel)\t\(allowedTime)\t\(accumulated)\t\(dose)")
}

// æ€»å‰‚é‡
print("æ€»å‰‚é‡: \(String(format: "%.1f%%", table.totalDose))")
```

### æ ¼å¼åŒ–æ—¶é—´å‡½æ•°

```swift
func formatTimeToHours(_ seconds: TimeInterval) -> String {
    let hours = seconds / 3600.0
    
    if hours >= 1.0 {
        return String(format: "%.0fh", hours)
    } else {
        let minutes = seconds / 60.0
        if minutes >= 1.0 {
            return String(format: "%.0fmin", minutes)
        } else {
            return String(format: "%.0fs", seconds)
        }
    }
}
```

---

## ğŸ“‹ æ•°æ®ç»“æ„å®šä¹‰

### ç®€åŒ–çš„è¡Œæ•°æ®ç»“æ„

```swift
struct ExposureTableRow {
    let soundLevel: String      // "85dB"
    let allowedDuration: String // "8h"
    let accumulatedSeconds: Int // 300
    let currentDose: String     // "6.3%"
}
```

### è·å–æ ¼å¼åŒ–æ•°æ®

```swift
func getFormattedTableData(standard: NoiseStandard = .niosh) -> [ExposureTableRow] {
    let manager = DecibelMeterManager.shared
    let table = manager.getPermissibleExposureDurationTable(standard: standard)
    
    return table.durations.map { duration in
        ExposureTableRow(
            soundLevel: String(format: "%.0fdB", duration.soundLevel),
            allowedDuration: formatTimeToHours(duration.allowedDuration),
            accumulatedSeconds: Int(duration.accumulatedDuration),
            currentDose: String(format: "%.1f%%", duration.currentLevelDose)
        )
    }
}
```

---

## ğŸ“¤ å¯¼å‡ºæ ¼å¼

### 1. JSONæ ¼å¼

```json
{
  "standard": "NIOSH",
  "totalDose": "101.8%",
  "data": [
    {
      "soundLevel": "85dB",
      "allowedDuration": "8h",
      "accumulatedSeconds": 300,
      "currentDose": "6.3%"
    },
    {
      "soundLevel": "88dB",
      "allowedDuration": "4h",
      "accumulatedSeconds": 450,
      "currentDose": "18.8%"
    }
  ]
}
```

### 2. CSVæ ¼å¼

```csv
å£°çº§,å…è®¸æ—¶é•¿,ç´¯è®¡è¾¾æ ‡æ—¶é•¿(ç§’),å½“å‰å£°çº§å‰‚é‡
85dB,8h,300,6.3%
88dB,4h,450,18.8%
91dB,2h,200,16.7%
94dB,1h,120,20.0%
97dB,30min,60,20.0%
100dB,15min,30,20.0%
103dB,8min,0,0.0%
106dB,4min,0,0.0%
109dB,2min,0,0.0%
112dB,1min,0,0.0%
115dB,28s,0,0.0%

æ€»å‰‚é‡,,,101.8%
```

---

## ğŸ¨ UIæ˜¾ç¤ºç¤ºä¾‹

### SwiftUIè¡¨æ ¼è§†å›¾

```swift
struct SimpleExposureTableView: View {
    let table: PermissibleExposureDurationTable
    
    var body: some View {
        VStack(spacing: 0) {
            // è¡¨å¤´
            HStack {
                Text("å£°çº§").frame(width: 60, alignment: .leading)
                Text("å…è®¸æ—¶é•¿").frame(width: 80, alignment: .leading)
                Text("ç´¯è®¡æ—¶é•¿(ç§’)").frame(width: 100, alignment: .trailing)
                Text("å‰‚é‡").frame(width: 60, alignment: .trailing)
            }
            .font(.caption).fontWeight(.bold)
            .padding(8).background(Color.gray.opacity(0.2))
            
            // æ•°æ®è¡Œ
            ForEach(table.durations) { duration in
                HStack {
                    Text(String(format: "%.0fdB", duration.soundLevel))
                        .frame(width: 60, alignment: .leading)
                    Text(formatTimeToHours(duration.allowedDuration))
                        .frame(width: 80, alignment: .leading)
                    Text(String(format: "%.0f", duration.accumulatedDuration))
                        .frame(width: 100, alignment: .trailing)
                    Text(String(format: "%.1f%%", duration.currentLevelDose))
                        .frame(width: 60, alignment: .trailing)
                }
                .padding(.vertical, 6)
            }
            
            // æ€»å‰‚é‡
            HStack {
                Text("æ€»å‰‚é‡").fontWeight(.bold)
                Spacer()
                Text(String(format: "%.1f%%", table.totalDose))
                    .fontWeight(.bold)
            }
            .padding(8)
        }
    }
}
```

---

## ğŸ“Š ä¸åŒæ ‡å‡†çš„è®°å½•æ¡æ•°

| æ ‡å‡† | åŸºå‡†é™å€¼ | äº¤æ¢ç‡ | å¤©èŠ±æ¿é™å€¼ | è®°å½•æ¡æ•° |
|------|---------|--------|-----------|---------|
| NIOSH | 85 dB | 3 dB | 115 dB | 11æ¡ |
| OSHA | 90 dB | 5 dB | 115 dB | 6æ¡ |
| GBZ | 85 dB | 3 dB | 115 dB | 11æ¡ |
| EU | 87 dB | 3 dB | 115 dB | 10æ¡ |

---

## âš ï¸ é‡è¦è¯´æ˜

### 1. ç´¯è®¡æ—¶é•¿å•ä½
- **å­˜å‚¨å•ä½**ï¼šç§’ï¼ˆTimeIntervalï¼‰
- **æ˜¾ç¤ºå•ä½**ï¼šç§’ï¼ˆæ•´æ•°ï¼‰
- **åŸå› **ï¼šä¾¿äºç²¾ç¡®è®¡ç®—å’Œç»Ÿè®¡

### 2. å…è®¸æ—¶é•¿æ ¼å¼
- **â‰¥1å°æ—¶**ï¼šæ˜¾ç¤ºä¸º "Xh"ï¼ˆå¦‚ï¼š8h, 4h, 2h, 1hï¼‰
- **â‰¥1åˆ†é’Ÿ**ï¼šæ˜¾ç¤ºä¸º "Xmin"ï¼ˆå¦‚ï¼š30min, 15min, 8minï¼‰
- **<1åˆ†é’Ÿ**ï¼šæ˜¾ç¤ºä¸º "Xs"ï¼ˆå¦‚ï¼š28sï¼‰

### 3. å‰‚é‡ç™¾åˆ†æ¯”
- **å•ä¸ªå£°çº§å‰‚é‡**ï¼šå¯ä»¥è¶…è¿‡100%
- **æ€»å‰‚é‡**ï¼šæ‰€æœ‰å£°çº§å‰‚é‡çš„ç´¯åŠ ï¼Œä¹Ÿå¯ä»¥è¶…è¿‡100%
- **è¶…è¿‡100%**ï¼šè¡¨ç¤ºè¯¥å£°çº§æˆ–æ€»ä½“æš´éœ²å·²è¶…æ ‡

### 4. æ•°æ®ç²¾åº¦
- **å£°çº§**ï¼šæ•´æ•°ï¼ˆå¦‚ï¼š85, 88, 91ï¼‰
- **ç´¯è®¡æ—¶é•¿**ï¼šæ•´æ•°ç§’ï¼ˆå¦‚ï¼š300, 450, 200ï¼‰
- **å‰‚é‡**ï¼šä¿ç•™1ä½å°æ•°ï¼ˆå¦‚ï¼š6.3%, 18.8%ï¼‰

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `NoiseDosimeterModels.swift` - æ•°æ®æ¨¡å‹å®šä¹‰
- `DecibelMeterManager.swift` - APIå®ç°
- `å…è®¸æš´éœ²æ—¶é•¿è¡¨ä½¿ç”¨ç¤ºä¾‹.swift` - å®Œæ•´ä½¿ç”¨ç¤ºä¾‹
- `å…è®¸æš´éœ²æ—¶é•¿è¡¨æ ¼å¼åŒ–ç¤ºä¾‹.swift` - æ ¼å¼åŒ–è¾“å‡ºç¤ºä¾‹
- `å…è®¸æš´éœ²æ—¶é•¿è¡¨APIæ–‡æ¡£.md` - APIæ–‡æ¡£

---

## âœ… æ€»ç»“

æœ€ç»ˆçš„å…è®¸æš´éœ²æ—¶é•¿è¡¨æ•°æ®æ ¼å¼ä¸ºï¼š

**4ä¸ªå­—æ®µ**ï¼š
1. âœ… å£°çº§ï¼ˆå¦‚ï¼š85dBï¼‰
2. âœ… å…è®¸æ—¶é•¿ï¼ˆå¦‚ï¼š8hï¼‰
3. âœ… ç´¯è®¡è¾¾æ ‡æ—¶é•¿ï¼ˆå•ä½ï¼šç§’ï¼Œå¦‚ï¼š300ï¼‰
4. âœ… å½“å‰å£°çº§å‰‚é‡ï¼ˆå¦‚ï¼š6.3%ï¼‰

**è®°å½•æ¡æ•°**ï¼š
- NIOSH/GBZï¼š11æ¡
- OSHAï¼š6æ¡
- EUï¼š10æ¡

**é¢å¤–ä¿¡æ¯**ï¼š
- æ€»å‰‚é‡ç™¾åˆ†æ¯”
- è¶…æ ‡æ£€æµ‹
- å¤šç§å¯¼å‡ºæ ¼å¼ï¼ˆJSONã€CSVï¼‰

